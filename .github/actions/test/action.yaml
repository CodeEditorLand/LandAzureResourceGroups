name: 'Test'

runs:
  using: 'composite'
  steps:
    - name: Setup
      uses: ./.github/actions/setup

    - name: 'Start X Virtual Frame Buffer'
      if: matrix.os == 'ubuntu-latest'
      shell: bash
      run: |
        sudo cp .azure-pipelines/linux/xvfb.init /etc/init.d/xvfb
        sudo chmod +x /etc/init.d/xvfb
        sudo update-rc.d xvfb defaults
        sudo service xvfb start

    - run: npm build
      shell: bash

    - run: npm test
      shell: bash
